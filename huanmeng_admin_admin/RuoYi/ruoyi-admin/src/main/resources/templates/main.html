<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>统计</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
    <link href="../static/css/font-awesome.min.css" th:href="@{/css/font-awesome.min.css}" rel="stylesheet"/>
    <link href="../static/css/main/animate.min.css" th:href="@{/css/main/animate.min.css}" rel="stylesheet"/>
    <link href="../static/css/main/style.min862f.css" th:href="@{/css/main/style.min862f.css}" rel="stylesheet"/>
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content">

    <div class="row">
        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right">月</span>
                    <h5>发贴数</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins" th:text="${postNum}">后台出错，请联系管理员！</h1>
                    <div th:class="'stat-percent font-bold '+(${postAdd}?'text-success':'text-danger')" th:text="${postRatio}+'%'">98% <i class="fa fa-bolt"></i>
                    </div>
                    <small>帖子数</small>
                </div>
            </div>
        </div>


        <div class="col-sm-3">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <span class="label label-success pull-right">月</span>
                    <h5>活跃用户</h5>
                </div>
                <div class="ibox-content">
                    <h1 class="no-margins"  th:text="${userNum}">后台出错，请联系管理员！</h1>
                    <div th:class="'stat-percent font-bold '+(${userAdd}?'text-success':'text-danger')" th:text="${userRatio}+'%'">98% <i class="fa fa-bolt"></i>
                    </div>
                    <small>活跃用户</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="">
                    <div class="row">
                        <div class="col-sm-9">
                            <div class="flot-chart">
                                    <div class="ibox float-e-margins">
                                        <div class="ibox-content" style="height:350px;">
                                            <div style="height:300px;" id="echarts-line-chart"></div>
                                        </div>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
</div>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/ajax/libs/flot/jquery.flot.js}"></script>

<th:block th:include="include :: echarts-js" />
<script type="text/javascript" th:inline="javascript">
    //获取当月天数
    function monthDay(){
        var date = new Date();
        var year = date.getFullYear();
        var month = date.getMonth()+1;
        var d = new Date(year, month, 0);
        var dataList=[];
        for(var i = 0; i<d.getDate();i++){
            dataList[i] = month+"月"+(i+1)+"号";
        }
        return dataList;
    }
    $(function () {
        var postNumList = /*[[${postNumList}]]*/ [];
        var userNumList = /*[[${userNumList}]]*/ [];
        console.log(postNumList);
        console.log(userNumList);
        var date = new Date();
        var postNumflag = [];
        var userNumflag = [];
        //对后台传过来的数据进行处理
        for(var i = 0;i<date.getDate();i++){
            //处理每日帖子数数据
            var postNumisNull = true;
            for(var j = 0;j<postNumList.length;j++){
                if(postNumList[j].day-1 == i){
                    postNumflag[i] = postNumList[j].num;
                    postNumisNull = false;
                    break;
                }
            }
            if(postNumisNull){
                postNumflag[i] = 0;
            }

            //处理每日活跃用户数据
            var userNumisNull = true;
            for(var j = 0;j<userNumList.length;j++){
                if(userNumList[j].day-1 == i){
                    userNumflag[i] = userNumList[j].num;
                    userNumisNull = false;
                    break;
                }
            }
            if(userNumisNull){
                userNumflag[i] = 0;
            }
        }
        postNumList = postNumflag;
        userNumList = userNumflag;
        console.log("postNumList"+postNumList);
        console.log("userNumList"+userNumList);
        var lineChart = echarts.init(document.getElementById("echarts-line-chart"));
        var lineoption = {
            title : {
                text: '月数据统计'
            },
            tooltip : {
                trigger: 'axis'
            },
            legend: {
                data:['新贴数','活跃人数']
            },
            grid:{
                x:40,
                x2:40,
                y2:24
            },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : monthDay()
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    axisLabel : {
                        formatter: '{value}'
                    }
                }
            ],
            series : [
                {
                    name:'新贴数',
                    type:'line',
                    data:postNumList,
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name: '平均值'}
                        ]
                    }
                },
                {
                    name:'活跃人数',
                    type:'line',
                    data:userNumList,
                    markPoint : {
                        data : [
                            {type : 'max', name: '最大值'},
                            {type : 'min', name: '最小值'}
                        ]
                    },
                    markLine : {
                        data : [
                            {type : 'average', name : '平均值'}
                        ]
                    }
                }
            ]
        };
        lineChart.setOption(lineoption);
        $(window).resize(lineChart.resize);
    })
</script>
</body>
</html>
